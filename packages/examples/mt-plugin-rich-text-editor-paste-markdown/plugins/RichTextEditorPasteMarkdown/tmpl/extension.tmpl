<mt:setvarblock name="js_include" append="1">
  <!-- <__trans_section component="richtexteditorpastemarkdown"> -->
  <script type="module">
    import { marked } from "https://cdnjs.cloudflare.com/ajax/libs/marked/15.0.4/lib/marked.esm.min.js";

    class RichTextEditorPasteMarkdown extends MTRichTextEditor.PasteMenuItemElement {
      constructor() {
        super();
        this.attachShadow({ mode: "open" }).innerHTML =
          "<__trans phrase='Convert from Markdown'>";
      }

      isEditorItemAvailable() {
        return (this.content?.plainText ?? "")
          .split("\n")
          .some((line) => line.startsWith("#") || line.startsWith("```"));
      }

      onEditorPaste() {
        this.insertPasteContent(marked(this.content?.plainText ?? ""));
      }
    }
    customElements.define(
      "mt-rich-text-editor-paste-menu-item-markdown",
      RichTextEditorPasteMarkdown
    );

    // install the item "markdown" in the paste menu.
    MTRichTextEditor.on("create", (options) => {
      options.pasteMenu.unshift("markdown");
    });
  </script>
  <!-- </__trans_section> -->
</mt:setvarblock>
